import{L as e,m as t,n as s,i as r,C as n,o as i,p as a,q as o,r as l,I as u,B as c,R as h,s as p,t as d,u as m,v as f,w as g,x as v,D as y,a as _,y as S,z as x,b as T,H as w,l as b,J as E,K as A,N as R,O as M,G as P,P as N,U as L,X as C,Y as O,Z as I,_ as U,$ as F,h as H,a0 as k,f as D,a1 as V,a2 as j,a3 as B,a4 as G,a5 as K,a6 as X,a7 as q,a8 as z,a9 as $,aa as W,ab as J,ac as Y,c as Q,ad as Z,d as ee,e as te,ae as se,af as re,ag as ne,ah as ie,V as ae,ai as oe}from"./three.module-8bdb5506.js";
/**
 * @license
 * Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * The complete set of authors may be found at
 * http://polymer.github.io/AUTHORS.txt
 * The complete set of contributors may be found at
 * http://polymer.github.io/CONTRIBUTORS.txt
 * Code distributed by Google as part of the polymer project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */const le="undefined"!=typeof window&&null!=window.customElements&&void 0!==window.customElements.polyfillWrapFlushCallback,ue=(e,t,s=null)=>{for(;t!==s;){const s=t.nextSibling;e.removeChild(t),t=s}},ce=`{{lit-${String(Math.random()).slice(2)}}}`,he=`\x3c!--${ce}--\x3e`,pe=new RegExp(`${ce}|${he}`);class de{constructor(e,t){this.parts=[],this.element=t;const s=[],r=[],n=document.createTreeWalker(t.content,133,null,!1);let i=0,a=-1,o=0;const{strings:l,values:{length:u}}=e;for(;o<u;){const e=n.nextNode();if(null!==e){if(a++,1===e.nodeType){if(e.hasAttributes()){const t=e.attributes,{length:s}=t;let r=0;for(let e=0;e<s;e++)me(t[e].name,"$lit$")&&r++;for(;r-- >0;){const t=l[o],s=ve.exec(t)[2],r=s.toLowerCase()+"$lit$",n=e.getAttribute(r);e.removeAttribute(r);const i=n.split(pe);this.parts.push({type:"attribute",index:a,name:s,strings:i}),o+=i.length-1}}"TEMPLATE"===e.tagName&&(r.push(e),n.currentNode=e.content)}else if(3===e.nodeType){const t=e.data;if(t.indexOf(ce)>=0){const r=e.parentNode,n=t.split(pe),i=n.length-1;for(let t=0;t<i;t++){let s,i=n[t];if(""===i)s=ge();else{const e=ve.exec(i);null!==e&&me(e[2],"$lit$")&&(i=i.slice(0,e.index)+e[1]+e[2].slice(0,-"$lit$".length)+e[3]),s=document.createTextNode(i)}r.insertBefore(s,e),this.parts.push({type:"node",index:++a})}""===n[i]?(r.insertBefore(ge(),e),s.push(e)):e.data=n[i],o+=i}}else if(8===e.nodeType)if(e.data===ce){const t=e.parentNode;null!==e.previousSibling&&a!==i||(a++,t.insertBefore(ge(),e)),i=a,this.parts.push({type:"node",index:a}),null===e.nextSibling?e.data="":(s.push(e),a--),o++}else{let t=-1;for(;-1!==(t=e.data.indexOf(ce,t+1));)this.parts.push({type:"node",index:-1}),o++}}else n.currentNode=r.pop()}for(const e of s)e.parentNode.removeChild(e)}}const me=(e,t)=>{const s=e.length-t.length;return s>=0&&e.slice(s)===t},fe=e=>-1!==e.index,ge=()=>document.createComment(""),ve=/([ \x09\x0a\x0c\x0d])([^\0-\x1F\x7F-\x9F "'>=/]+)([ \x09\x0a\x0c\x0d]*=[ \x09\x0a\x0c\x0d]*(?:[^ \x09\x0a\x0c\x0d"'`<>=]*|"[^"]*|'[^']*))$/;function ye(e,t){const{element:{content:s},parts:r}=e,n=document.createTreeWalker(s,133,null,!1);let i=Se(r),a=r[i],o=-1,l=0;const u=[];let c=null;for(;n.nextNode();){o++;const e=n.currentNode;for(e.previousSibling===c&&(c=null),t.has(e)&&(u.push(e),null===c&&(c=e)),null!==c&&l++;void 0!==a&&a.index===o;)a.index=null!==c?-1:a.index-l,i=Se(r,i),a=r[i]}u.forEach((e=>e.parentNode.removeChild(e)))}const _e=e=>{let t=11===e.nodeType?0:1;const s=document.createTreeWalker(e,133,null,!1);for(;s.nextNode();)t++;return t},Se=(e,t=-1)=>{for(let s=t+1;s<e.length;s++){const t=e[s];if(fe(t))return s}return-1};
/**
 * @license
 * Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * The complete set of authors may be found at
 * http://polymer.github.io/AUTHORS.txt
 * The complete set of contributors may be found at
 * http://polymer.github.io/CONTRIBUTORS.txt
 * Code distributed by Google as part of the polymer project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
const xe=new WeakMap,Te=e=>"function"==typeof e&&xe.has(e),we={},be={};
/**
 * @license
 * Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * The complete set of authors may be found at
 * http://polymer.github.io/AUTHORS.txt
 * The complete set of contributors may be found at
 * http://polymer.github.io/CONTRIBUTORS.txt
 * Code distributed by Google as part of the polymer project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
class Ee{constructor(e,t,s){this.__parts=[],this.template=e,this.processor=t,this.options=s}update(e){let t=0;for(const s of this.__parts)void 0!==s&&s.setValue(e[t]),t++;for(const e of this.__parts)void 0!==e&&e.commit()}_clone(){const e=le?this.template.element.content.cloneNode(!0):document.importNode(this.template.element.content,!0),t=[],s=this.template.parts,r=document.createTreeWalker(e,133,null,!1);let n,i=0,a=0,o=r.nextNode();for(;i<s.length;)if(n=s[i],fe(n)){for(;a<n.index;)a++,"TEMPLATE"===o.nodeName&&(t.push(o),r.currentNode=o.content),null===(o=r.nextNode())&&(r.currentNode=t.pop(),o=r.nextNode());if("node"===n.type){const e=this.processor.handleTextExpression(this.options);e.insertAfterNode(o.previousSibling),this.__parts.push(e)}else this.__parts.push(...this.processor.handleAttributeExpressions(o,n.name,n.strings,this.options));i++}else this.__parts.push(void 0),i++;return le&&(document.adoptNode(e),customElements.upgrade(e)),e}}
/**
 * @license
 * Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * The complete set of authors may be found at
 * http://polymer.github.io/AUTHORS.txt
 * The complete set of contributors may be found at
 * http://polymer.github.io/CONTRIBUTORS.txt
 * Code distributed by Google as part of the polymer project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */const Ae=window.trustedTypes&&trustedTypes.createPolicy("lit-html",{createHTML:e=>e}),Re=` ${ce} `;class Me{constructor(e,t,s,r){this.strings=e,this.values=t,this.type=s,this.processor=r}getHTML(){const e=this.strings.length-1;let t="",s=!1;for(let r=0;r<e;r++){const e=this.strings[r],n=e.lastIndexOf("\x3c!--");s=(n>-1||s)&&-1===e.indexOf("--\x3e",n+1);const i=ve.exec(e);t+=null===i?e+(s?Re:he):e.substr(0,i.index)+i[1]+i[2]+"$lit$"+i[3]+ce}return t+=this.strings[e],t}getTemplateElement(){const e=document.createElement("template");let t=this.getHTML();return void 0!==Ae&&(t=Ae.createHTML(t)),e.innerHTML=t,e}}
/**
 * @license
 * Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * The complete set of authors may be found at
 * http://polymer.github.io/AUTHORS.txt
 * The complete set of contributors may be found at
 * http://polymer.github.io/CONTRIBUTORS.txt
 * Code distributed by Google as part of the polymer project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */const Pe=e=>null===e||!("object"==typeof e||"function"==typeof e),Ne=e=>Array.isArray(e)||!(!e||!e[Symbol.iterator]);class Le{constructor(e,t,s){this.dirty=!0,this.element=e,this.name=t,this.strings=s,this.parts=[];for(let e=0;e<s.length-1;e++)this.parts[e]=this._createPart()}_createPart(){return new Ce(this)}_getValue(){const e=this.strings,t=e.length-1,s=this.parts;if(1===t&&""===e[0]&&""===e[1]){const e=s[0].value;if("symbol"==typeof e)return String(e);if("string"==typeof e||!Ne(e))return e}let r="";for(let n=0;n<t;n++){r+=e[n];const t=s[n];if(void 0!==t){const e=t.value;if(Pe(e)||!Ne(e))r+="string"==typeof e?e:String(e);else for(const t of e)r+="string"==typeof t?t:String(t)}}return r+=e[t],r}commit(){this.dirty&&(this.dirty=!1,this.element.setAttribute(this.name,this._getValue()))}}class Ce{constructor(e){this.value=void 0,this.committer=e}setValue(e){e===we||Pe(e)&&e===this.value||(this.value=e,Te(e)||(this.committer.dirty=!0))}commit(){for(;Te(this.value);){const e=this.value;this.value=we,e(this)}this.value!==we&&this.committer.commit()}}class Oe{constructor(e){this.value=void 0,this.__pendingValue=void 0,this.options=e}appendInto(e){this.startNode=e.appendChild(ge()),this.endNode=e.appendChild(ge())}insertAfterNode(e){this.startNode=e,this.endNode=e.nextSibling}appendIntoPart(e){e.__insert(this.startNode=ge()),e.__insert(this.endNode=ge())}insertAfterPart(e){e.__insert(this.startNode=ge()),this.endNode=e.endNode,e.endNode=this.startNode}setValue(e){this.__pendingValue=e}commit(){if(null===this.startNode.parentNode)return;for(;Te(this.__pendingValue);){const e=this.__pendingValue;this.__pendingValue=we,e(this)}const e=this.__pendingValue;e!==we&&(Pe(e)?e!==this.value&&this.__commitText(e):e instanceof Me?this.__commitTemplateResult(e):e instanceof Node?this.__commitNode(e):Ne(e)?this.__commitIterable(e):e===be?(this.value=be,this.clear()):this.__commitText(e))}__insert(e){this.endNode.parentNode.insertBefore(e,this.endNode)}__commitNode(e){this.value!==e&&(this.clear(),this.__insert(e),this.value=e)}__commitText(e){const t=this.startNode.nextSibling,s="string"==typeof(e=null==e?"":e)?e:String(e);t===this.endNode.previousSibling&&3===t.nodeType?t.data=s:this.__commitNode(document.createTextNode(s)),this.value=e}__commitTemplateResult(e){const t=this.options.templateFactory(e);if(this.value instanceof Ee&&this.value.template===t)this.value.update(e.values);else{const s=new Ee(t,e.processor,this.options),r=s._clone();s.update(e.values),this.__commitNode(r),this.value=s}}__commitIterable(e){Array.isArray(this.value)||(this.value=[],this.clear());const t=this.value;let s,r=0;for(const n of e)s=t[r],void 0===s&&(s=new Oe(this.options),t.push(s),0===r?s.appendIntoPart(this):s.insertAfterPart(t[r-1])),s.setValue(n),s.commit(),r++;r<t.length&&(t.length=r,this.clear(s&&s.endNode))}clear(e=this.startNode){ue(this.startNode.parentNode,e.nextSibling,this.endNode)}}class Ie{constructor(e,t,s){if(this.value=void 0,this.__pendingValue=void 0,2!==s.length||""!==s[0]||""!==s[1])throw new Error("Boolean attributes can only contain a single expression");this.element=e,this.name=t,this.strings=s}setValue(e){this.__pendingValue=e}commit(){for(;Te(this.__pendingValue);){const e=this.__pendingValue;this.__pendingValue=we,e(this)}if(this.__pendingValue===we)return;const e=!!this.__pendingValue;this.value!==e&&(e?this.element.setAttribute(this.name,""):this.element.removeAttribute(this.name),this.value=e),this.__pendingValue=we}}class Ue extends Le{constructor(e,t,s){super(e,t,s),this.single=2===s.length&&""===s[0]&&""===s[1]}_createPart(){return new Fe(this)}_getValue(){return this.single?this.parts[0].value:super._getValue()}commit(){this.dirty&&(this.dirty=!1,this.element[this.name]=this._getValue())}}class Fe extends Ce{}let He=!1;(()=>{try{const e={get capture(){return He=!0,!1}};window.addEventListener("test",e,e),window.removeEventListener("test",e,e)}catch(e){}})();class ke{constructor(e,t,s){this.value=void 0,this.__pendingValue=void 0,this.element=e,this.eventName=t,this.eventContext=s,this.__boundHandleEvent=e=>this.handleEvent(e)}setValue(e){this.__pendingValue=e}commit(){for(;Te(this.__pendingValue);){const e=this.__pendingValue;this.__pendingValue=we,e(this)}if(this.__pendingValue===we)return;const e=this.__pendingValue,t=this.value,s=null==e||null!=t&&(e.capture!==t.capture||e.once!==t.once||e.passive!==t.passive),r=null!=e&&(null==t||s);s&&this.element.removeEventListener(this.eventName,this.__boundHandleEvent,this.__options),r&&(this.__options=De(e),this.element.addEventListener(this.eventName,this.__boundHandleEvent,this.__options)),this.value=e,this.__pendingValue=we}handleEvent(e){"function"==typeof this.value?this.value.call(this.eventContext||this.element,e):this.value.handleEvent(e)}}const De=e=>e&&(He?{capture:e.capture,passive:e.passive,once:e.once}:e.capture)
/**
 * @license
 * Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * The complete set of authors may be found at
 * http://polymer.github.io/AUTHORS.txt
 * The complete set of contributors may be found at
 * http://polymer.github.io/CONTRIBUTORS.txt
 * Code distributed by Google as part of the polymer project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */;function Ve(e){let t=je.get(e.type);void 0===t&&(t={stringsArray:new WeakMap,keyString:new Map},je.set(e.type,t));let s=t.stringsArray.get(e.strings);if(void 0!==s)return s;const r=e.strings.join(ce);return s=t.keyString.get(r),void 0===s&&(s=new de(e,e.getTemplateElement()),t.keyString.set(r,s)),t.stringsArray.set(e.strings,s),s}const je=new Map,Be=new WeakMap;
/**
 * @license
 * Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * The complete set of authors may be found at
 * http://polymer.github.io/AUTHORS.txt
 * The complete set of contributors may be found at
 * http://polymer.github.io/CONTRIBUTORS.txt
 * Code distributed by Google as part of the polymer project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */const Ge=new
/**
 * @license
 * Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * The complete set of authors may be found at
 * http://polymer.github.io/AUTHORS.txt
 * The complete set of contributors may be found at
 * http://polymer.github.io/CONTRIBUTORS.txt
 * Code distributed by Google as part of the polymer project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
class{handleAttributeExpressions(e,t,s,r){const n=t[0];if("."===n){return new Ue(e,t.slice(1),s).parts}if("@"===n)return[new ke(e,t.slice(1),r.eventContext)];if("?"===n)return[new Ie(e,t.slice(1),s)];return new Le(e,t,s).parts}handleTextExpression(e){return new Oe(e)}};
/**
 * @license
 * Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * The complete set of authors may be found at
 * http://polymer.github.io/AUTHORS.txt
 * The complete set of contributors may be found at
 * http://polymer.github.io/CONTRIBUTORS.txt
 * Code distributed by Google as part of the polymer project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */"undefined"!=typeof window&&(window.litHtmlVersions||(window.litHtmlVersions=[])).push("1.3.0");const Ke=(e,...t)=>new Me(e,t,"html",Ge)
/**
 * @license
 * Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * The complete set of authors may be found at
 * http://polymer.github.io/AUTHORS.txt
 * The complete set of contributors may be found at
 * http://polymer.github.io/CONTRIBUTORS.txt
 * Code distributed by Google as part of the polymer project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */,Xe=(e,t)=>`${e}--${t}`;let qe=!0;void 0===window.ShadyCSS?qe=!1:void 0===window.ShadyCSS.prepareTemplateDom&&(console.warn("Incompatible ShadyCSS version detected. Please update to at least @webcomponents/webcomponentsjs@2.0.2 and @webcomponents/shadycss@1.3.1."),qe=!1);const ze=e=>t=>{const s=Xe(t.type,e);let r=je.get(s);void 0===r&&(r={stringsArray:new WeakMap,keyString:new Map},je.set(s,r));let n=r.stringsArray.get(t.strings);if(void 0!==n)return n;const i=t.strings.join(ce);if(n=r.keyString.get(i),void 0===n){const s=t.getTemplateElement();qe&&window.ShadyCSS.prepareTemplateDom(s,e),n=new de(t,s),r.keyString.set(i,n)}return r.stringsArray.set(t.strings,n),n},$e=["html","svg"],We=new Set,Je=(e,t,s)=>{We.add(e);const r=s?s.element:document.createElement("template"),n=t.querySelectorAll("style"),{length:i}=n;if(0===i)return void window.ShadyCSS.prepareTemplateStyles(r,e);const a=document.createElement("style");for(let e=0;e<i;e++){const t=n[e];t.parentNode.removeChild(t),a.textContent+=t.textContent}(e=>{$e.forEach((t=>{const s=je.get(Xe(t,e));void 0!==s&&s.keyString.forEach((e=>{const{element:{content:t}}=e,s=new Set;Array.from(t.querySelectorAll("style")).forEach((e=>{s.add(e)})),ye(e,s)}))}))})(e);const o=r.content;s?function(e,t,s=null){const{element:{content:r},parts:n}=e;if(null==s)return void r.appendChild(t);const i=document.createTreeWalker(r,133,null,!1);let a=Se(n),o=0,l=-1;for(;i.nextNode();)for(l++,i.currentNode===s&&(o=_e(t),s.parentNode.insertBefore(t,s));-1!==a&&n[a].index===l;){if(o>0){for(;-1!==a;)n[a].index+=o,a=Se(n,a);return}a=Se(n,a)}}(s,a,o.firstChild):o.insertBefore(a,o.firstChild),window.ShadyCSS.prepareTemplateStyles(r,e);const l=o.querySelector("style");if(window.ShadyCSS.nativeShadow&&null!==l)t.insertBefore(l.cloneNode(!0),t.firstChild);else if(s){o.insertBefore(a,o.firstChild);const e=new Set;e.add(a),ye(s,e)}};window.JSCompiler_renameProperty=(e,t)=>e;const Ye={toAttribute(e,t){switch(t){case Boolean:return e?"":null;case Object:case Array:return null==e?e:JSON.stringify(e)}return e},fromAttribute(e,t){switch(t){case Boolean:return null!==e;case Number:return null===e?null:Number(e);case Object:case Array:return JSON.parse(e)}return e}},Qe=(e,t)=>t!==e&&(t==t||e==e),Ze={attribute:!0,type:String,converter:Ye,reflect:!1,hasChanged:Qe};class et extends HTMLElement{constructor(){super(),this.initialize()}static get observedAttributes(){this.finalize();const e=[];return this._classProperties.forEach(((t,s)=>{const r=this._attributeNameForProperty(s,t);void 0!==r&&(this._attributeToPropertyMap.set(r,s),e.push(r))})),e}static _ensureClassProperties(){if(!this.hasOwnProperty(JSCompiler_renameProperty("_classProperties",this))){this._classProperties=new Map;const e=Object.getPrototypeOf(this)._classProperties;void 0!==e&&e.forEach(((e,t)=>this._classProperties.set(t,e)))}}static createProperty(e,t=Ze){if(this._ensureClassProperties(),this._classProperties.set(e,t),t.noAccessor||this.prototype.hasOwnProperty(e))return;const s="symbol"==typeof e?Symbol():`__${e}`,r=this.getPropertyDescriptor(e,s,t);void 0!==r&&Object.defineProperty(this.prototype,e,r)}static getPropertyDescriptor(e,t,s){return{get(){return this[t]},set(r){const n=this[e];this[t]=r,this.requestUpdateInternal(e,n,s)},configurable:!0,enumerable:!0}}static getPropertyOptions(e){return this._classProperties&&this._classProperties.get(e)||Ze}static finalize(){const e=Object.getPrototypeOf(this);if(e.hasOwnProperty("finalized")||e.finalize(),this.finalized=!0,this._ensureClassProperties(),this._attributeToPropertyMap=new Map,this.hasOwnProperty(JSCompiler_renameProperty("properties",this))){const e=this.properties,t=[...Object.getOwnPropertyNames(e),..."function"==typeof Object.getOwnPropertySymbols?Object.getOwnPropertySymbols(e):[]];for(const s of t)this.createProperty(s,e[s])}}static _attributeNameForProperty(e,t){const s=t.attribute;return!1===s?void 0:"string"==typeof s?s:"string"==typeof e?e.toLowerCase():void 0}static _valueHasChanged(e,t,s=Qe){return s(e,t)}static _propertyValueFromAttribute(e,t){const s=t.type,r=t.converter||Ye,n="function"==typeof r?r:r.fromAttribute;return n?n(e,s):e}static _propertyValueToAttribute(e,t){if(void 0===t.reflect)return;const s=t.type,r=t.converter;return(r&&r.toAttribute||Ye.toAttribute)(e,s)}initialize(){this._updateState=0,this._updatePromise=new Promise((e=>this._enableUpdatingResolver=e)),this._changedProperties=new Map,this._saveInstanceProperties(),this.requestUpdateInternal()}_saveInstanceProperties(){this.constructor._classProperties.forEach(((e,t)=>{if(this.hasOwnProperty(t)){const e=this[t];delete this[t],this._instanceProperties||(this._instanceProperties=new Map),this._instanceProperties.set(t,e)}}))}_applyInstanceProperties(){this._instanceProperties.forEach(((e,t)=>this[t]=e)),this._instanceProperties=void 0}connectedCallback(){this.enableUpdating()}enableUpdating(){void 0!==this._enableUpdatingResolver&&(this._enableUpdatingResolver(),this._enableUpdatingResolver=void 0)}disconnectedCallback(){}attributeChangedCallback(e,t,s){t!==s&&this._attributeToProperty(e,s)}_propertyToAttribute(e,t,s=Ze){const r=this.constructor,n=r._attributeNameForProperty(e,s);if(void 0!==n){const e=r._propertyValueToAttribute(t,s);if(void 0===e)return;this._updateState=8|this._updateState,null==e?this.removeAttribute(n):this.setAttribute(n,e),this._updateState=-9&this._updateState}}_attributeToProperty(e,t){if(8&this._updateState)return;const s=this.constructor,r=s._attributeToPropertyMap.get(e);if(void 0!==r){const e=s.getPropertyOptions(r);this._updateState=16|this._updateState,this[r]=s._propertyValueFromAttribute(t,e),this._updateState=-17&this._updateState}}requestUpdateInternal(e,t,s){let r=!0;if(void 0!==e){const n=this.constructor;s=s||n.getPropertyOptions(e),n._valueHasChanged(this[e],t,s.hasChanged)?(this._changedProperties.has(e)||this._changedProperties.set(e,t),!0!==s.reflect||16&this._updateState||(void 0===this._reflectingProperties&&(this._reflectingProperties=new Map),this._reflectingProperties.set(e,s))):r=!1}!this._hasRequestedUpdate&&r&&(this._updatePromise=this._enqueueUpdate())}requestUpdate(e,t){return this.requestUpdateInternal(e,t),this.updateComplete}async _enqueueUpdate(){this._updateState=4|this._updateState;try{await this._updatePromise}catch(e){}const e=this.performUpdate();return null!=e&&await e,!this._hasRequestedUpdate}get _hasRequestedUpdate(){return 4&this._updateState}get hasUpdated(){return 1&this._updateState}performUpdate(){if(!this._hasRequestedUpdate)return;this._instanceProperties&&this._applyInstanceProperties();let e=!1;const t=this._changedProperties;try{e=this.shouldUpdate(t),e?this.update(t):this._markUpdated()}catch(t){throw e=!1,this._markUpdated(),t}e&&(1&this._updateState||(this._updateState=1|this._updateState,this.firstUpdated(t)),this.updated(t))}_markUpdated(){this._changedProperties=new Map,this._updateState=-5&this._updateState}get updateComplete(){return this._getUpdateComplete()}_getUpdateComplete(){return this._updatePromise}shouldUpdate(e){return!0}update(e){void 0!==this._reflectingProperties&&this._reflectingProperties.size>0&&(this._reflectingProperties.forEach(((e,t)=>this._propertyToAttribute(t,this[t],e))),this._reflectingProperties=void 0),this._markUpdated()}updated(e){}firstUpdated(e){}}et.finalized=!0;
/**
@license
Copyright (c) 2019 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at
http://polymer.github.io/LICENSE.txt The complete set of authors may be found at
http://polymer.github.io/AUTHORS.txt The complete set of contributors may be
found at http://polymer.github.io/CONTRIBUTORS.txt Code distributed by Google as
part of the polymer project is also subject to an additional IP rights grant
found at http://polymer.github.io/PATENTS.txt
*/
const tt=window.ShadowRoot&&(void 0===window.ShadyCSS||window.ShadyCSS.nativeShadow)&&"adoptedStyleSheets"in Document.prototype&&"replace"in CSSStyleSheet.prototype,st=Symbol();class rt{constructor(e,t){if(t!==st)throw new Error("CSSResult is not constructable. Use `unsafeCSS` or `css` instead.");this.cssText=e}get styleSheet(){return void 0===this._styleSheet&&(tt?(this._styleSheet=new CSSStyleSheet,this._styleSheet.replaceSync(this.cssText)):this._styleSheet=null),this._styleSheet}toString(){return this.cssText}}
/**
 * @license
 * Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * The complete set of authors may be found at
 * http://polymer.github.io/AUTHORS.txt
 * The complete set of contributors may be found at
 * http://polymer.github.io/CONTRIBUTORS.txt
 * Code distributed by Google as part of the polymer project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
(window.litElementVersions||(window.litElementVersions=[])).push("2.4.0");const nt={};class it extends et{static getStyles(){return this.styles}static _getUniqueStyles(){if(this.hasOwnProperty(JSCompiler_renameProperty("_styles",this)))return;const e=this.getStyles();if(Array.isArray(e)){const t=(e,s)=>e.reduceRight(((e,s)=>Array.isArray(s)?t(s,e):(e.add(s),e)),s),s=t(e,new Set),r=[];s.forEach((e=>r.unshift(e))),this._styles=r}else this._styles=void 0===e?[]:[e];this._styles=this._styles.map((e=>{if(e instanceof CSSStyleSheet&&!tt){const t=Array.prototype.slice.call(e.cssRules).reduce(((e,t)=>e+t.cssText),"");return new rt(String(t),st)}return e}))}initialize(){super.initialize(),this.constructor._getUniqueStyles(),this.renderRoot=this.createRenderRoot(),window.ShadowRoot&&this.renderRoot instanceof window.ShadowRoot&&this.adoptStyles()}createRenderRoot(){return this.attachShadow({mode:"open"})}adoptStyles(){const e=this.constructor._styles;0!==e.length&&(void 0===window.ShadyCSS||window.ShadyCSS.nativeShadow?tt?this.renderRoot.adoptedStyleSheets=e.map((e=>e instanceof CSSStyleSheet?e:e.styleSheet)):this._needsShimAdoptedStyleSheets=!0:window.ShadyCSS.ScopingShim.prepareAdoptedCssText(e.map((e=>e.cssText)),this.localName))}connectedCallback(){super.connectedCallback(),this.hasUpdated&&void 0!==window.ShadyCSS&&window.ShadyCSS.styleElement(this)}update(e){const t=this.render();super.update(e),t!==nt&&this.constructor.render(t,this.renderRoot,{scopeName:this.localName,eventContext:this}),this._needsShimAdoptedStyleSheets&&(this._needsShimAdoptedStyleSheets=!1,this.constructor._styles.forEach((e=>{const t=document.createElement("style");t.textContent=e.cssText,this.renderRoot.appendChild(t)})))}render(){return nt}}it.finalized=!0,it.render=(e,t,s)=>{if(!s||"object"!=typeof s||!s.scopeName)throw new Error("The `scopeName` option is required.");const r=s.scopeName,n=Be.has(t),i=qe&&11===t.nodeType&&!!t.host,a=i&&!We.has(r),o=a?document.createDocumentFragment():t;if(((e,t,s)=>{let r=Be.get(t);void 0===r&&(ue(t,t.firstChild),Be.set(t,r=new Oe(Object.assign({templateFactory:Ve},s))),r.appendInto(t)),r.setValue(e),r.commit()})(e,o,Object.assign({templateFactory:ze(r)},s)),a){const e=Be.get(o);Be.delete(o);const s=e.value instanceof Ee?e.value.template:void 0;Je(r,o,s),ue(t,t.firstChild),t.appendChild(o),Be.set(t,e)}!n&&i&&window.ShadyCSS.styleElement(t.host)};var at=function(){function le(t){e.call(this,t),this.dracoLoader=null,this.ddsLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register((function(e){return new me(e)})),this.register((function(e){return new ge(e)})),this.register((function(e){return new ve(e)})),this.register((function(e){return new fe(e)})),this.register((function(e){return new pe(e)})),this.register((function(e){return new ye(e)}))}function ue(){var e={};return{get:function(t){return e[t]},add:function(t,s){e[t]=s},remove:function(t){delete e[t]},removeAll:function(){e={}}}}le.prototype=Object.assign(Object.create(e.prototype),{constructor:le,load:function(e,r,n,i){var a,o=this;a=""!==this.resourcePath?this.resourcePath:""!==this.path?this.path:t.extractUrlBase(e),this.manager.itemStart(e);var l=function(t){i?i(t):console.error(t),o.manager.itemError(e),o.manager.itemEnd(e)},u=new s(this.manager);u.setPath(this.path),u.setResponseType("arraybuffer"),u.setRequestHeader(this.requestHeader),u.setWithCredentials(this.withCredentials),u.load(e,(function(t){try{o.parse(t,a,(function(t){r(t),o.manager.itemEnd(e)}),l)}catch(e){l(e)}}),n,l)},setDRACOLoader:function(e){return this.dracoLoader=e,this},setDDSLoader:function(e){return this.ddsLoader=e,this},setKTX2Loader:function(e){return this.ktx2Loader=e,this},setMeshoptDecoder:function(e){return this.meshoptDecoder=e,this},register:function(e){return-1===this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.push(e),this},unregister:function(e){return-1!==this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this},parse:function(e,s,r,n){var i,a={},o={};if("string"==typeof e)i=e;else if(t.decodeText(new Uint8Array(e,0,4))===_e){try{a[ce.KHR_BINARY_GLTF]=new Te(e)}catch(e){return void(n&&n(e))}i=a[ce.KHR_BINARY_GLTF].content}else i=t.decodeText(new Uint8Array(e));var l=JSON.parse(i);if(void 0===l.asset||l.asset.version[0]<2)n&&n(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));else{var u=new Ye(l,{path:s||this.resourcePath||"",crossOrigin:this.crossOrigin,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});u.fileLoader.setRequestHeader(this.requestHeader);for(var c=0;c<this.pluginCallbacks.length;c++){var h=this.pluginCallbacks[c](u);o[h.name]=h,a[h.name]=!0}if(l.extensionsUsed)for(c=0;c<l.extensionsUsed.length;++c){var p=l.extensionsUsed[c],d=l.extensionsRequired||[];switch(p){case ce.KHR_MATERIALS_UNLIT:a[p]=new de;break;case ce.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:a[p]=new Ae;break;case ce.KHR_DRACO_MESH_COMPRESSION:a[p]=new we(l,this.dracoLoader);break;case ce.MSFT_TEXTURE_DDS:a[p]=new he(this.ddsLoader);break;case ce.KHR_TEXTURE_TRANSFORM:a[p]=new be;break;case ce.KHR_MESH_QUANTIZATION:a[p]=new Re;break;default:d.indexOf(p)>=0&&void 0===o[p]&&console.warn('THREE.GLTFLoader: Unknown extension "'+p+'".')}}u.setExtensions(a),u.setPlugins(o),u.parse(r,n)}}});var ce={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:"KHR_materials_pbrSpecularGlossiness",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",MSFT_TEXTURE_DDS:"MSFT_texture_dds"};function he(e){if(!e)throw new Error("THREE.GLTFLoader: Attempting to load .dds texture without importing DDSLoader");this.name=ce.MSFT_TEXTURE_DDS,this.ddsLoader=e}function pe(e){this.parser=e,this.name=ce.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}function de(){this.name=ce.KHR_MATERIALS_UNLIT}function me(e){this.parser=e,this.name=ce.KHR_MATERIALS_CLEARCOAT}function fe(e){this.parser=e,this.name=ce.KHR_MATERIALS_TRANSMISSION}function ge(e){this.parser=e,this.name=ce.KHR_TEXTURE_BASISU}function ve(e){this.parser=e,this.name=ce.EXT_TEXTURE_WEBP,this.isSupported=null}function ye(e){this.name=ce.EXT_MESHOPT_COMPRESSION,this.parser=e}pe.prototype._markDefs=function(){for(var e=this.parser,t=this.parser.json.nodes||[],s=0,r=t.length;s<r;s++){var n=t[s];n.extensions&&n.extensions[this.name]&&void 0!==n.extensions[this.name].light&&e._addNodeRef(this.cache,n.extensions[this.name].light)}},pe.prototype._loadLight=function(e){var t=this.parser,s="light:"+e,r=t.cache.get(s);if(r)return r;var i,a=t.json,o=((a.extensions&&a.extensions[this.name]||{}).lights||[])[e],l=new n(16777215);void 0!==o.color&&l.fromArray(o.color);var u=void 0!==o.range?o.range:0;switch(o.type){case"directional":(i=new j(l)).target.position.set(0,0,-1),i.add(i.target);break;case"point":(i=new V(l)).distance=u;break;case"spot":(i=new D(l)).distance=u,o.spot=o.spot||{},o.spot.innerConeAngle=void 0!==o.spot.innerConeAngle?o.spot.innerConeAngle:0,o.spot.outerConeAngle=void 0!==o.spot.outerConeAngle?o.spot.outerConeAngle:Math.PI/4,i.angle=o.spot.outerConeAngle,i.penumbra=1-o.spot.innerConeAngle/o.spot.outerConeAngle,i.target.position.set(0,0,-1),i.add(i.target);break;default:throw new Error('THREE.GLTFLoader: Unexpected light type, "'+o.type+'".')}return i.position.set(0,0,0),i.decay=2,void 0!==o.intensity&&(i.intensity=o.intensity),i.name=t.createUniqueName(o.name||"light_"+e),r=Promise.resolve(i),t.cache.add(s,r),r},pe.prototype.createNodeAttachment=function(e){var t=this,s=this.parser,r=s.json.nodes[e],n=(r.extensions&&r.extensions[this.name]||{}).light;return void 0===n?null:this._loadLight(n).then((function(e){return s._getNodeRef(t.cache,n,e)}))},de.prototype.getMaterialType=function(){return r},de.prototype.extendParams=function(e,t,s){var r=[];e.color=new n(1,1,1),e.opacity=1;var i=t.pbrMetallicRoughness;if(i){if(Array.isArray(i.baseColorFactor)){var a=i.baseColorFactor;e.color.fromArray(a),e.opacity=a[3]}void 0!==i.baseColorTexture&&r.push(s.assignTexture(e,"map",i.baseColorTexture))}return Promise.all(r)},me.prototype.getMaterialType=function(e){var t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?B:null},me.prototype.extendMaterialParams=function(e,t){var s=this.parser,r=s.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();var n=[],i=r.extensions[this.name];if(void 0!==i.clearcoatFactor&&(t.clearcoat=i.clearcoatFactor),void 0!==i.clearcoatTexture&&n.push(s.assignTexture(t,"clearcoatMap",i.clearcoatTexture)),void 0!==i.clearcoatRoughnessFactor&&(t.clearcoatRoughness=i.clearcoatRoughnessFactor),void 0!==i.clearcoatRoughnessTexture&&n.push(s.assignTexture(t,"clearcoatRoughnessMap",i.clearcoatRoughnessTexture)),void 0!==i.clearcoatNormalTexture&&(n.push(s.assignTexture(t,"clearcoatNormalMap",i.clearcoatNormalTexture)),void 0!==i.clearcoatNormalTexture.scale)){var a=i.clearcoatNormalTexture.scale;t.clearcoatNormalScale=new _(a,a)}return Promise.all(n)},fe.prototype.getMaterialType=function(e){var t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?B:null},fe.prototype.extendMaterialParams=function(e,t){var s=this.parser,r=s.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();var n=[],i=r.extensions[this.name];return void 0!==i.transmissionFactor&&(t.transmission=i.transmissionFactor),void 0!==i.transmissionTexture&&n.push(s.assignTexture(t,"transmissionMap",i.transmissionTexture)),Promise.all(n)},ge.prototype.loadTexture=function(e){var t=this.parser,s=t.json,r=s.textures[e];if(!r.extensions||!r.extensions[this.name])return null;var n=r.extensions[this.name],i=s.images[n.source],a=t.options.ktx2Loader;if(!a){if(s.extensionsRequired&&s.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return t.loadTextureImage(e,i,a)},ve.prototype.loadTexture=function(e){var t=this.name,s=this.parser,r=s.json,n=r.textures[e];if(!n.extensions||!n.extensions[t])return null;var i=n.extensions[t],a=r.images[i.source],o=a.uri?s.options.manager.getHandler(a.uri):s.textureLoader;return this.detectSupport().then((function(n){if(n)return s.loadTextureImage(e,a,o);if(r.extensionsRequired&&r.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return s.loadTexture(e)}))},ve.prototype.detectSupport=function(){return this.isSupported||(this.isSupported=new Promise((function(e){var t=new Image;t.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",t.onload=t.onerror=function(){e(1===t.height)}}))),this.isSupported},ye.prototype.loadBufferView=function(e){var t=this.parser.json,s=t.bufferViews[e];if(s.extensions&&s.extensions[this.name]){var r=s.extensions[this.name],n=this.parser.getDependency("buffer",r.buffer),i=this.parser.options.meshoptDecoder;if(!i||!i.supported){if(t.extensionsRequired&&t.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return Promise.all([n,i.ready]).then((function(e){var t=r.byteOffset||0,s=r.byteLength||0,n=r.count,a=r.byteStride,o=new ArrayBuffer(n*a),l=new Uint8Array(e[0],t,s);return i.decodeGltfBuffer(new Uint8Array(o),n,a,l,r.mode,r.filter),o}))}return null};var _e="glTF",Se=1313821514,xe=5130562;function Te(e){this.name=ce.KHR_BINARY_GLTF,this.content=null,this.body=null;var s=new DataView(e,0,12);if(this.header={magic:t.decodeText(new Uint8Array(e.slice(0,4))),version:s.getUint32(4,!0),length:s.getUint32(8,!0)},this.header.magic!==_e)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");for(var r=new DataView(e,12),n=0;n<r.byteLength;){var i=r.getUint32(n,!0);n+=4;var a=r.getUint32(n,!0);if(n+=4,a===Se){var o=new Uint8Array(e,12+n,i);this.content=t.decodeText(o)}else if(a===xe){var l=12+n;this.body=e.slice(l,l+i)}n+=i}if(null===this.content)throw new Error("THREE.GLTFLoader: JSON content not found.")}function we(e,t){if(!t)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=ce.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=t,this.dracoLoader.preload()}function be(){this.name=ce.KHR_TEXTURE_TRANSFORM}function Ee(e){i.call(this),this.isGLTFSpecularGlossinessMaterial=!0;var t=["#ifdef USE_SPECULARMAP","\tuniform sampler2D specularMap;","#endif"].join("\n"),s=["#ifdef USE_GLOSSINESSMAP","\tuniform sampler2D glossinessMap;","#endif"].join("\n"),r=["vec3 specularFactor = specular;","#ifdef USE_SPECULARMAP","\tvec4 texelSpecular = texture2D( specularMap, vUv );","\ttexelSpecular = sRGBToLinear( texelSpecular );","\t// reads channel RGB, compatible with a glTF Specular-Glossiness (RGBA) texture","\tspecularFactor *= texelSpecular.rgb;","#endif"].join("\n"),a=["float glossinessFactor = glossiness;","#ifdef USE_GLOSSINESSMAP","\tvec4 texelGlossiness = texture2D( glossinessMap, vUv );","\t// reads channel A, compatible with a glTF Specular-Glossiness (RGBA) texture","\tglossinessFactor *= texelGlossiness.a;","#endif"].join("\n"),o=["PhysicalMaterial material;","material.diffuseColor = diffuseColor.rgb * ( 1. - max( specularFactor.r, max( specularFactor.g, specularFactor.b ) ) );","vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );","float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );","material.specularRoughness = max( 1.0 - glossinessFactor, 0.0525 ); // 0.0525 corresponds to the base mip of a 256 cubemap.","material.specularRoughness += geometryRoughness;","material.specularRoughness = min( material.specularRoughness, 1.0 );","material.specularColor = specularFactor;"].join("\n"),l={specular:{value:(new n).setHex(16777215)},glossiness:{value:1},specularMap:{value:null},glossinessMap:{value:null}};this._extraUniforms=l,this.onBeforeCompile=function(e){for(var n in l)e.uniforms[n]=l[n];e.fragmentShader=e.fragmentShader.replace("uniform float roughness;","uniform vec3 specular;").replace("uniform float metalness;","uniform float glossiness;").replace("#include <roughnessmap_pars_fragment>",t).replace("#include <metalnessmap_pars_fragment>",s).replace("#include <roughnessmap_fragment>",r).replace("#include <metalnessmap_fragment>",a).replace("#include <lights_physical_fragment>",o)},Object.defineProperties(this,{specular:{get:function(){return l.specular.value},set:function(e){l.specular.value=e}},specularMap:{get:function(){return l.specularMap.value},set:function(e){l.specularMap.value=e,e?this.defines.USE_SPECULARMAP="":delete this.defines.USE_SPECULARMAP}},glossiness:{get:function(){return l.glossiness.value},set:function(e){l.glossiness.value=e}},glossinessMap:{get:function(){return l.glossinessMap.value},set:function(e){l.glossinessMap.value=e,e?(this.defines.USE_GLOSSINESSMAP="",this.defines.USE_UV=""):(delete this.defines.USE_GLOSSINESSMAP,delete this.defines.USE_UV)}}}),delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this.setValues(e)}function Ae(){return{name:ce.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS,specularGlossinessParams:["color","map","lightMap","lightMapIntensity","aoMap","aoMapIntensity","emissive","emissiveIntensity","emissiveMap","bumpMap","bumpScale","normalMap","normalMapType","displacementMap","displacementScale","displacementBias","specularMap","specular","glossinessMap","glossiness","alphaMap","envMap","envMapIntensity","refractionRatio"],getMaterialType:function(){return Ee},extendParams:function(e,t,s){var r=t.extensions[this.name];e.color=new n(1,1,1),e.opacity=1;var i=[];if(Array.isArray(r.diffuseFactor)){var a=r.diffuseFactor;e.color.fromArray(a),e.opacity=a[3]}if(void 0!==r.diffuseTexture&&i.push(s.assignTexture(e,"map",r.diffuseTexture)),e.emissive=new n(0,0,0),e.glossiness=void 0!==r.glossinessFactor?r.glossinessFactor:1,e.specular=new n(1,1,1),Array.isArray(r.specularFactor)&&e.specular.fromArray(r.specularFactor),void 0!==r.specularGlossinessTexture){var o=r.specularGlossinessTexture;i.push(s.assignTexture(e,"glossinessMap",o)),i.push(s.assignTexture(e,"specularMap",o))}return Promise.all(i)},createMaterial:function(e){var t=new Ee(e);return t.fog=!0,t.color=e.color,t.map=void 0===e.map?null:e.map,t.lightMap=null,t.lightMapIntensity=1,t.aoMap=void 0===e.aoMap?null:e.aoMap,t.aoMapIntensity=1,t.emissive=e.emissive,t.emissiveIntensity=1,t.emissiveMap=void 0===e.emissiveMap?null:e.emissiveMap,t.bumpMap=void 0===e.bumpMap?null:e.bumpMap,t.bumpScale=1,t.normalMap=void 0===e.normalMap?null:e.normalMap,t.normalMapType=a,e.normalScale&&(t.normalScale=e.normalScale),t.displacementMap=null,t.displacementScale=1,t.displacementBias=0,t.specularMap=void 0===e.specularMap?null:e.specularMap,t.specular=e.specular,t.glossinessMap=void 0===e.glossinessMap?null:e.glossinessMap,t.glossiness=e.glossiness,t.alphaMap=null,t.envMap=void 0===e.envMap?null:e.envMap,t.envMapIntensity=1,t.refractionRatio=.98,t}}}function Re(){this.name=ce.KHR_MESH_QUANTIZATION}function Me(e,t,s,r){G.call(this,e,t,s,r)}we.prototype.decodePrimitive=function(e,t){var s=this.json,r=this.dracoLoader,n=e.extensions[this.name].bufferView,i=e.extensions[this.name].attributes,a={},o={},l={};for(var u in i){var c=Ve[u]||u.toLowerCase();a[c]=i[u]}for(u in e.attributes){c=Ve[u]||u.toLowerCase();if(void 0!==i[u]){var h=s.accessors[e.attributes[u]],p=Fe[h.componentType];l[c]=p,o[c]=!0===h.normalized}}return t.getDependency("bufferView",n).then((function(e){return new Promise((function(t){r.decodeDracoFile(e,(function(e){for(var s in e.attributes){var r=e.attributes[s],n=o[s];void 0!==n&&(r.normalized=n)}t(e)}),a,l)}))}))},be.prototype.extendTexture=function(e,t){return e=e.clone(),void 0!==t.offset&&e.offset.fromArray(t.offset),void 0!==t.rotation&&(e.rotation=t.rotation),void 0!==t.scale&&e.repeat.fromArray(t.scale),void 0!==t.texCoord&&console.warn('THREE.GLTFLoader: Custom UV sets in "'+this.name+'" extension not yet supported.'),e.needsUpdate=!0,e},Ee.prototype=Object.create(i.prototype),Ee.prototype.constructor=Ee,Ee.prototype.copy=function(e){return i.prototype.copy.call(this,e),this.specularMap=e.specularMap,this.specular.copy(e.specular),this.glossinessMap=e.glossinessMap,this.glossiness=e.glossiness,delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this},Me.prototype=Object.create(G.prototype),Me.prototype.constructor=Me,Me.prototype.copySampleValue_=function(e){for(var t=this.resultBuffer,s=this.sampleValues,r=this.valueSize,n=e*r*3+r,i=0;i!==r;i++)t[i]=s[n+i];return t},Me.prototype.beforeStart_=Me.prototype.copySampleValue_,Me.prototype.afterEnd_=Me.prototype.copySampleValue_,Me.prototype.interpolate_=function(e,t,s,r){for(var n=this.resultBuffer,i=this.sampleValues,a=this.valueSize,o=2*a,l=3*a,u=r-t,c=(s-t)/u,h=c*c,p=h*c,d=e*l,m=d-l,f=-2*p+3*h,g=p-h,v=1-f,y=g-h+c,_=0;_!==a;_++){var S=i[m+_+a],x=i[m+_+o]*u,T=i[d+_+a],w=i[d+_]*u;n[_]=v*S+y*x+f*T+g*w}return n};var Pe=0,Ne=1,Le=2,Ce=3,Oe=4,Ie=5,Ue=6,Fe={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},He={9728:K,9729:p,9984:X,9985:q,9986:z,9987:d},ke={33071:$,33648:W,10497:m},De={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},Ve={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv2",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},je={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},Be={CUBICSPLINE:void 0,LINEAR:O,STEP:J},Ge="OPAQUE",Ke="MASK",Xe="BLEND";function qe(e,t){return"string"!=typeof e||""===e?"":(/^https?:\/\//i.test(t)&&/^\//.test(e)&&(t=t.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(e)||/^data:.*,.*$/i.test(e)||/^blob:.*$/i.test(e)?e:t+e)}function ze(e,t,s){for(var r in s.extensions)void 0===e[r]&&(t.userData.gltfExtensions=t.userData.gltfExtensions||{},t.userData.gltfExtensions[r]=s.extensions[r])}function $e(e,t){void 0!==t.extras&&("object"==typeof t.extras?Object.assign(e.userData,t.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+t.extras))}function We(e,t){if(e.updateMorphTargets(),void 0!==t.weights)for(var s=0,r=t.weights.length;s<r;s++)e.morphTargetInfluences[s]=t.weights[s];if(t.extras&&Array.isArray(t.extras.targetNames)){var n=t.extras.targetNames;if(e.morphTargetInfluences.length===n.length){e.morphTargetDictionary={};for(s=0,r=n.length;s<r;s++)e.morphTargetDictionary[n[s]]=s}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function Je(e){for(var t="",s=Object.keys(e).sort(),r=0,n=s.length;r<n;r++)t+=s[r]+":"+e[s[r]]+";";return t}function Ye(e,t){this.json=e||{},this.extensions={},this.plugins={},this.options=t||{},this.cache=new ue,this.associations=new Map,this.primitiveCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.nodeNamesUsed={},"undefined"!=typeof createImageBitmap&&!1===/Firefox/.test(navigator.userAgent)?this.textureLoader=new o(this.options.manager):this.textureLoader=new l(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.fileLoader=new s(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),"use-credentials"===this.options.crossOrigin&&this.fileLoader.setWithCredentials(!0)}function Qe(e,t,s){var r=t.attributes,n=[];function i(t,r){return s.getDependency("accessor",t).then((function(t){e.setAttribute(r,t)}))}for(var a in r){var o=Ve[a]||a.toLowerCase();o in e.attributes||n.push(i(r[a],o))}if(void 0!==t.indices&&!e.index){var l=s.getDependency("accessor",t.indices).then((function(t){e.setIndex(t)}));n.push(l)}return $e(e,t),function(e,t,s){var r=t.attributes,n=new ie;if(void 0!==r.POSITION){var i=(p=s.json.accessors[r.POSITION]).min,a=p.max;if(void 0!==i&&void 0!==a){n.set(new ae(i[0],i[1],i[2]),new ae(a[0],a[1],a[2]));var o=t.targets;if(void 0!==o){for(var l=new ae,u=new ae,c=0,h=o.length;c<h;c++){var p,d=o[c];if(void 0!==d.POSITION)i=(p=s.json.accessors[d.POSITION]).min,a=p.max,void 0!==i&&void 0!==a?(u.setX(Math.max(Math.abs(i[0]),Math.abs(a[0]))),u.setY(Math.max(Math.abs(i[1]),Math.abs(a[1]))),u.setZ(Math.max(Math.abs(i[2]),Math.abs(a[2]))),l.max(u)):console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}n.expandByVector(l)}e.boundingBox=n;var m=new oe;n.getCenter(m.center),m.radius=n.min.distanceTo(n.max)/2,e.boundingSphere=m}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}(e,t,s),Promise.all(n).then((function(){return void 0!==t.targets?function(e,t,s){for(var r=!1,n=!1,i=0,a=t.length;i<a&&(void 0!==(u=t[i]).POSITION&&(r=!0),void 0!==u.NORMAL&&(n=!0),!r||!n);i++);if(!r&&!n)return Promise.resolve(e);var o=[],l=[];for(i=0,a=t.length;i<a;i++){var u=t[i];if(r){var c=void 0!==u.POSITION?s.getDependency("accessor",u.POSITION):e.attributes.position;o.push(c)}n&&(c=void 0!==u.NORMAL?s.getDependency("accessor",u.NORMAL):e.attributes.normal,l.push(c))}return Promise.all([Promise.all(o),Promise.all(l)]).then((function(t){var s=t[0],i=t[1];return r&&(e.morphAttributes.position=s),n&&(e.morphAttributes.normal=i),e.morphTargetsRelative=!0,e}))}(e,t.targets,s):e}))}function Ze(e,t){var s=e.getIndex();if(null===s){var r=[],n=e.getAttribute("position");if(void 0===n)return console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),e;for(var i=0;i<n.count;i++)r.push(i);e.setIndex(r),s=e.getIndex()}var a=s.count-2,o=[];if(t===ee)for(i=1;i<=a;i++)o.push(s.getX(0)),o.push(s.getX(i)),o.push(s.getX(i+1));else for(i=0;i<a;i++)i%2==0?(o.push(s.getX(i)),o.push(s.getX(i+1)),o.push(s.getX(i+2))):(o.push(s.getX(i+2)),o.push(s.getX(i+1)),o.push(s.getX(i)));o.length/3!==a&&console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");var l=e.clone();return l.setIndex(o),l}return Ye.prototype.setExtensions=function(e){this.extensions=e},Ye.prototype.setPlugins=function(e){this.plugins=e},Ye.prototype.parse=function(e,t){var s=this,r=this.json,n=this.extensions;this.cache.removeAll(),this._invokeAll((function(e){return e._markDefs&&e._markDefs()})),Promise.all([this.getDependencies("scene"),this.getDependencies("animation"),this.getDependencies("camera")]).then((function(t){var i={scene:t[0][r.scene||0],scenes:t[0],animations:t[1],cameras:t[2],asset:r.asset,parser:s,userData:{}};ze(n,i,r),$e(i,r),e(i)})).catch(t)},Ye.prototype._markDefs=function(){for(var e=this.json.nodes||[],t=this.json.skins||[],s=this.json.meshes||[],r=0,n=t.length;r<n;r++)for(var i=t[r].joints,a=0,o=i.length;a<o;a++)e[i[a]].isBone=!0;for(var l=0,u=e.length;l<u;l++){var c=e[l];void 0!==c.mesh&&(this._addNodeRef(this.meshCache,c.mesh),void 0!==c.skin&&(s[c.mesh].isSkinnedMesh=!0)),void 0!==c.camera&&this._addNodeRef(this.cameraCache,c.camera)}},Ye.prototype._addNodeRef=function(e,t){void 0!==t&&(void 0===e.refs[t]&&(e.refs[t]=e.uses[t]=0),e.refs[t]++)},Ye.prototype._getNodeRef=function(e,t,s){if(e.refs[t]<=1)return s;var r=s.clone();return r.name+="_instance_"+e.uses[t]++,r},Ye.prototype._invokeOne=function(e){var t=Object.values(this.plugins);t.push(this);for(var s=0;s<t.length;s++){var r=e(t[s]);if(r)return r}},Ye.prototype._invokeAll=function(e){var t=Object.values(this.plugins);t.unshift(this);for(var s=[],r=0;r<t.length;r++){var n=e(t[r]);n&&s.push(n)}return s},Ye.prototype.getDependency=function(e,t){var s=e+":"+t,r=this.cache.get(s);if(!r){switch(e){case"scene":r=this.loadScene(t);break;case"node":r=this.loadNode(t);break;case"mesh":r=this._invokeOne((function(e){return e.loadMesh&&e.loadMesh(t)}));break;case"accessor":r=this.loadAccessor(t);break;case"bufferView":r=this._invokeOne((function(e){return e.loadBufferView&&e.loadBufferView(t)}));break;case"buffer":r=this.loadBuffer(t);break;case"material":r=this._invokeOne((function(e){return e.loadMaterial&&e.loadMaterial(t)}));break;case"texture":r=this._invokeOne((function(e){return e.loadTexture&&e.loadTexture(t)}));break;case"skin":r=this.loadSkin(t);break;case"animation":r=this.loadAnimation(t);break;case"camera":r=this.loadCamera(t);break;default:throw new Error("Unknown type: "+e)}this.cache.add(s,r)}return r},Ye.prototype.getDependencies=function(e){var t=this.cache.get(e);if(!t){var s=this,r=this.json[e+("mesh"===e?"es":"s")]||[];t=Promise.all(r.map((function(t,r){return s.getDependency(e,r)}))),this.cache.add(e,t)}return t},Ye.prototype.loadBuffer=function(e){var t=this.json.buffers[e],s=this.fileLoader;if(t.type&&"arraybuffer"!==t.type)throw new Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(void 0===t.uri&&0===e)return Promise.resolve(this.extensions[ce.KHR_BINARY_GLTF].body);var r=this.options;return new Promise((function(e,n){s.load(qe(t.uri,r.path),e,void 0,(function(){n(new Error('THREE.GLTFLoader: Failed to load buffer "'+t.uri+'".'))}))}))},Ye.prototype.loadBufferView=function(e){var t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then((function(e){var s=t.byteLength||0,r=t.byteOffset||0;return e.slice(r,r+s)}))},Ye.prototype.loadAccessor=function(e){var t=this,s=this.json,r=this.json.accessors[e];if(void 0===r.bufferView&&void 0===r.sparse)return Promise.resolve(null);var n=[];return void 0!==r.bufferView?n.push(this.getDependency("bufferView",r.bufferView)):n.push(null),void 0!==r.sparse&&(n.push(this.getDependency("bufferView",r.sparse.indices.bufferView)),n.push(this.getDependency("bufferView",r.sparse.values.bufferView))),Promise.all(n).then((function(e){var n,i,a=e[0],o=De[r.type],l=Fe[r.componentType],h=l.BYTES_PER_ELEMENT,p=h*o,d=r.byteOffset||0,m=void 0!==r.bufferView?s.bufferViews[r.bufferView].byteStride:void 0,f=!0===r.normalized;if(m&&m!==p){var g=Math.floor(d/m),v="InterleavedBuffer:"+r.bufferView+":"+r.componentType+":"+g+":"+r.count,y=t.cache.get(v);y||(n=new l(a,g*m,r.count*m/h),y=new u(n,m/h),t.cache.add(v,y)),i=new Q(y,o,d%m/h,f)}else n=null===a?new l(r.count*o):new l(a,d,r.count*o),i=new c(n,o,f);if(void 0!==r.sparse){var _=De.SCALAR,S=Fe[r.sparse.indices.componentType],x=r.sparse.indices.byteOffset||0,T=r.sparse.values.byteOffset||0,w=new S(e[1],x,r.sparse.count*_),b=new l(e[2],T,r.sparse.count*o);null!==a&&(i=new c(i.array.slice(),i.itemSize,i.normalized));for(var E=0,A=w.length;E<A;E++){var R=w[E];if(i.setX(R,b[E*o]),o>=2&&i.setY(R,b[E*o+1]),o>=3&&i.setZ(R,b[E*o+2]),o>=4&&i.setW(R,b[E*o+3]),o>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return i}))},Ye.prototype.loadTexture=function(e){var t,s,r=this.json,n=this.options,i=r.textures[e],a=i.extensions||{};return(t=a[ce.MSFT_TEXTURE_DDS]?r.images[a[ce.MSFT_TEXTURE_DDS].source]:r.images[i.source]).uri&&(s=n.manager.getHandler(t.uri)),s||(s=a[ce.MSFT_TEXTURE_DDS]?this.extensions[ce.MSFT_TEXTURE_DDS].ddsLoader:this.textureLoader),this.loadTextureImage(e,t,s)},Ye.prototype.loadTextureImage=function(e,t,s){var r=this,n=this.json,i=this.options,a=n.textures[e],o=self.URL||self.webkitURL,l=t.uri,u=!1,c=!0;return"image/jpeg"===t.mimeType&&(c=!1),void 0!==t.bufferView&&(l=r.getDependency("bufferView",t.bufferView).then((function(e){if("image/png"===t.mimeType){var s=new DataView(e,25,1).getUint8(0,!1);c=6===s||4===s||3===s}u=!0;var r=new Blob([e],{type:t.mimeType});return l=o.createObjectURL(r)}))),Promise.resolve(l).then((function(e){return new Promise((function(t,r){var n=t;!0===s.isImageBitmapLoader&&(n=function(e){t(new Z(e))}),s.load(qe(e,i.path),n,void 0,r)}))})).then((function(t){!0===u&&o.revokeObjectURL(l),t.flipY=!1,a.name&&(t.name=a.name),c||(t.format=h);var s=(n.samplers||{})[a.sampler]||{};return t.magFilter=He[s.magFilter]||p,t.minFilter=He[s.minFilter]||d,t.wrapS=ke[s.wrapS]||m,t.wrapT=ke[s.wrapT]||m,r.associations.set(t,{type:"textures",index:e}),t}))},Ye.prototype.assignTexture=function(e,t,s){var r=this;return this.getDependency("texture",s.index).then((function(n){if(void 0===s.texCoord||0==s.texCoord||"aoMap"===t&&1==s.texCoord||console.warn("THREE.GLTFLoader: Custom UV set "+s.texCoord+" for texture "+t+" not yet supported."),r.extensions[ce.KHR_TEXTURE_TRANSFORM]){var i=void 0!==s.extensions?s.extensions[ce.KHR_TEXTURE_TRANSFORM]:void 0;if(i){var a=r.associations.get(n);n=r.extensions[ce.KHR_TEXTURE_TRANSFORM].extendTexture(n,i),r.associations.set(n,a)}}e[t]=n}))},Ye.prototype.assignFinalMaterial=function(e){var t=e.geometry,s=e.material,r=void 0!==t.attributes.tangent,n=void 0!==t.attributes.color,i=void 0===t.attributes.normal,a=!0===e.isSkinnedMesh,o=Object.keys(t.morphAttributes).length>0,l=o&&void 0!==t.morphAttributes.normal;if(e.isPoints){var u="PointsMaterial:"+s.uuid,c=this.cache.get(u);c||(c=new f,g.prototype.copy.call(c,s),c.color.copy(s.color),c.map=s.map,c.sizeAttenuation=!1,this.cache.add(u,c)),s=c}else if(e.isLine){u="LineBasicMaterial:"+s.uuid;var h=this.cache.get(u);h||(h=new v,g.prototype.copy.call(h,s),h.color.copy(s.color),this.cache.add(u,h)),s=h}if(r||n||i||a||o){u="ClonedMaterial:"+s.uuid+":";s.isGLTFSpecularGlossinessMaterial&&(u+="specular-glossiness:"),a&&(u+="skinning:"),r&&(u+="vertex-tangents:"),n&&(u+="vertex-colors:"),i&&(u+="flat-shading:"),o&&(u+="morph-targets:"),l&&(u+="morph-normals:");var p=this.cache.get(u);p||(p=s.clone(),a&&(p.skinning=!0),r&&(p.vertexTangents=!0),n&&(p.vertexColors=!0),i&&(p.flatShading=!0),o&&(p.morphTargets=!0),l&&(p.morphNormals=!0),this.cache.add(u,p),this.associations.set(p,this.associations.get(s))),s=p}s.aoMap&&void 0===t.attributes.uv2&&void 0!==t.attributes.uv&&t.setAttribute("uv2",t.attributes.uv),s.normalScale&&!r&&(s.normalScale.y=-s.normalScale.y),s.clearcoatNormalScale&&!r&&(s.clearcoatNormalScale.y=-s.clearcoatNormalScale.y),e.material=s},Ye.prototype.getMaterialType=function(){return i},Ye.prototype.loadMaterial=function(e){var t,s=this,i=this.json,a=this.extensions,o=i.materials[e],l={},u=o.extensions||{},c=[];if(u[ce.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS]){var h=a[ce.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS];t=h.getMaterialType(),c.push(h.extendParams(l,o,s))}else if(u[ce.KHR_MATERIALS_UNLIT]){var p=a[ce.KHR_MATERIALS_UNLIT];t=p.getMaterialType(),c.push(p.extendParams(l,o,s))}else{var d=o.pbrMetallicRoughness||{};if(l.color=new n(1,1,1),l.opacity=1,Array.isArray(d.baseColorFactor)){var m=d.baseColorFactor;l.color.fromArray(m),l.opacity=m[3]}void 0!==d.baseColorTexture&&c.push(s.assignTexture(l,"map",d.baseColorTexture)),l.metalness=void 0!==d.metallicFactor?d.metallicFactor:1,l.roughness=void 0!==d.roughnessFactor?d.roughnessFactor:1,void 0!==d.metallicRoughnessTexture&&(c.push(s.assignTexture(l,"metalnessMap",d.metallicRoughnessTexture)),c.push(s.assignTexture(l,"roughnessMap",d.metallicRoughnessTexture))),t=this._invokeOne((function(t){return t.getMaterialType&&t.getMaterialType(e)})),c.push(Promise.all(this._invokeAll((function(t){return t.extendMaterialParams&&t.extendMaterialParams(e,l)}))))}!0===o.doubleSided&&(l.side=y);var f=o.alphaMode||Ge;return f===Xe?(l.transparent=!0,l.depthWrite=!1):(l.transparent=!1,f===Ke&&(l.alphaTest=void 0!==o.alphaCutoff?o.alphaCutoff:.5)),void 0!==o.normalTexture&&t!==r&&(c.push(s.assignTexture(l,"normalMap",o.normalTexture)),l.normalScale=new _(1,1),void 0!==o.normalTexture.scale&&l.normalScale.set(o.normalTexture.scale,o.normalTexture.scale)),void 0!==o.occlusionTexture&&t!==r&&(c.push(s.assignTexture(l,"aoMap",o.occlusionTexture)),void 0!==o.occlusionTexture.strength&&(l.aoMapIntensity=o.occlusionTexture.strength)),void 0!==o.emissiveFactor&&t!==r&&(l.emissive=(new n).fromArray(o.emissiveFactor)),void 0!==o.emissiveTexture&&t!==r&&c.push(s.assignTexture(l,"emissiveMap",o.emissiveTexture)),Promise.all(c).then((function(){var r;return r=t===Ee?a[ce.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].createMaterial(l):new t(l),o.name&&(r.name=o.name),r.map&&(r.map.encoding=S),r.emissiveMap&&(r.emissiveMap.encoding=S),$e(r,o),s.associations.set(r,{type:"materials",index:e}),o.extensions&&ze(a,r,o),r}))},Ye.prototype.createUniqueName=function(e){for(var t=x.sanitizeNodeName(e||""),s=1;this.nodeNamesUsed[t];++s)t=e+"_"+s;return this.nodeNamesUsed[t]=!0,t},Ye.prototype.loadGeometries=function(e){var t=this,s=this.extensions,r=this.primitiveCache;function n(e){return s[ce.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(e,t).then((function(s){return Qe(s,e,t)}))}for(var i,a,o=[],l=0,u=e.length;l<u;l++){var c,h=e[l],p=(a=void 0,(a=(i=h).extensions&&i.extensions[ce.KHR_DRACO_MESH_COMPRESSION])?"draco:"+a.bufferView+":"+a.indices+":"+Je(a.attributes):i.indices+":"+Je(i.attributes)+":"+i.mode),d=r[p];if(d)o.push(d.promise);else c=h.extensions&&h.extensions[ce.KHR_DRACO_MESH_COMPRESSION]?n(h):Qe(new T,h,t),r[p]={primitive:h,promise:c},o.push(c)}return Promise.all(o)},Ye.prototype.loadMesh=function(e){for(var t,s=this,r=this.json,n=this.extensions,a=r.meshes[e],o=a.primitives,l=[],u=0,c=o.length;u<c;u++){var h=void 0===o[u].material?(void 0===(t=this.cache).DefaultMaterial&&(t.DefaultMaterial=new i({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:Y})),t.DefaultMaterial):this.getDependency("material",o[u].material);l.push(h)}return l.push(s.loadGeometries(o)),Promise.all(l).then((function(t){for(var r=t.slice(0,t.length-1),i=t[t.length-1],l=[],u=0,c=i.length;u<c;u++){var h,p=i[u],d=o[u],m=r[u];if(d.mode===Oe||d.mode===Ie||d.mode===Ue||void 0===d.mode)!0!==(h=!0===a.isSkinnedMesh?new w(p,m):new b(p,m)).isSkinnedMesh||h.geometry.attributes.skinWeight.normalized||h.normalizeSkinWeights(),d.mode===Ie?h.geometry=Ze(h.geometry,te):d.mode===Ue&&(h.geometry=Ze(h.geometry,ee));else if(d.mode===Ne)h=new E(p,m);else if(d.mode===Ce)h=new A(p,m);else if(d.mode===Le)h=new R(p,m);else{if(d.mode!==Pe)throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+d.mode);h=new M(p,m)}Object.keys(h.geometry.morphAttributes).length>0&&We(h,a),h.name=s.createUniqueName(a.name||"mesh_"+e),$e(h,a),d.extensions&&ze(n,h,d),s.assignFinalMaterial(h),l.push(h)}if(1===l.length)return l[0];var f=new P;for(u=0,c=l.length;u<c;u++)f.add(l[u]);return f}))},Ye.prototype.loadCamera=function(e){var t,s=this.json.cameras[e],r=s[s.type];if(r)return"perspective"===s.type?t=new N(L.radToDeg(r.yfov),r.aspectRatio||1,r.znear||1,r.zfar||2e6):"orthographic"===s.type&&(t=new C(-r.xmag,r.xmag,r.ymag,-r.ymag,r.znear,r.zfar)),s.name&&(t.name=this.createUniqueName(s.name)),$e(t,s),Promise.resolve(t);console.warn("THREE.GLTFLoader: Missing camera parameters.")},Ye.prototype.loadSkin=function(e){var t=this.json.skins[e],s={joints:t.joints};return void 0===t.inverseBindMatrices?Promise.resolve(s):this.getDependency("accessor",t.inverseBindMatrices).then((function(e){return s.inverseBindMatrices=e,s}))},Ye.prototype.loadAnimation=function(e){for(var t=this.json.animations[e],s=[],r=[],n=[],i=[],a=[],o=0,l=t.channels.length;o<l;o++){var u=t.channels[o],c=t.samplers[u.sampler],h=u.target,p=void 0!==h.node?h.node:h.id,d=void 0!==t.parameters?t.parameters[c.input]:c.input,m=void 0!==t.parameters?t.parameters[c.output]:c.output;s.push(this.getDependency("node",p)),r.push(this.getDependency("accessor",d)),n.push(this.getDependency("accessor",m)),i.push(c),a.push(h)}return Promise.all([Promise.all(s),Promise.all(r),Promise.all(n),Promise.all(i),Promise.all(a)]).then((function(s){for(var r=s[0],n=s[1],i=s[2],a=s[3],o=s[4],l=[],u=0,c=r.length;u<c;u++){var h=r[u],p=n[u],d=i[u],m=a[u],f=o[u];if(void 0!==h){var g;switch(h.updateMatrix(),h.matrixAutoUpdate=!0,je[f.path]){case je.weights:g=ne;break;case je.rotation:g=re;break;case je.position:case je.scale:default:g=se}var v=h.name?h.name:h.uuid,y=void 0!==m.interpolation?Be[m.interpolation]:O,_=[];je[f.path]===je.weights?h.traverse((function(e){!0===e.isMesh&&e.morphTargetInfluences&&_.push(e.name?e.name:e.uuid)})):_.push(v);var S=d.array;if(d.normalized){var x;if(S.constructor===Int8Array)x=1/127;else if(S.constructor===Uint8Array)x=1/255;else if(S.constructor==Int16Array)x=1/32767;else{if(S.constructor!==Uint16Array)throw new Error("THREE.GLTFLoader: Unsupported output accessor component type.");x=1/65535}for(var T=new Float32Array(S.length),w=0,b=S.length;w<b;w++)T[w]=S[w]*x;S=T}for(w=0,b=_.length;w<b;w++){var E=new g(_[w]+"."+je[f.path],p.array,S,y);"CUBICSPLINE"===m.interpolation&&(E.createInterpolant=function(e){return new Me(this.times,this.values,this.getValueSize()/3,e)},E.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),l.push(E)}}}var A=t.name?t.name:"animation_"+e;return new I(A,void 0,l)}))},Ye.prototype.loadNode=function(e){var t,s=this.json,r=this.extensions,n=this,i=s.nodes[e],a=i.name?n.createUniqueName(i.name):"";return(t=[],void 0!==i.mesh&&t.push(n.getDependency("mesh",i.mesh).then((function(e){var t=n._getNodeRef(n.meshCache,i.mesh,e);return void 0!==i.weights&&t.traverse((function(e){if(e.isMesh)for(var t=0,s=i.weights.length;t<s;t++)e.morphTargetInfluences[t]=i.weights[t]})),t}))),void 0!==i.camera&&t.push(n.getDependency("camera",i.camera).then((function(e){return n._getNodeRef(n.cameraCache,i.camera,e)}))),n._invokeAll((function(t){return t.createNodeAttachment&&t.createNodeAttachment(e)})).forEach((function(e){t.push(e)})),Promise.all(t)).then((function(t){var s;if((s=!0===i.isBone?new U:t.length>1?new P:1===t.length?t[0]:new F)!==t[0])for(var o=0,l=t.length;o<l;o++)s.add(t[o]);if(i.name&&(s.userData.name=i.name,s.name=a),$e(s,i),i.extensions&&ze(r,s,i),void 0!==i.matrix){var u=new H;u.fromArray(i.matrix),s.applyMatrix4(u)}else void 0!==i.translation&&s.position.fromArray(i.translation),void 0!==i.rotation&&s.quaternion.fromArray(i.rotation),void 0!==i.scale&&s.scale.fromArray(i.scale);return n.associations.set(s,{type:"nodes",index:e}),s}))},Ye.prototype.loadScene=function(){function e(t,s,r,n){var i=r.nodes[t];return n.getDependency("node",t).then((function(e){return void 0===i.skin?e:n.getDependency("skin",i.skin).then((function(e){for(var s=[],r=0,i=(t=e).joints.length;r<i;r++)s.push(n.getDependency("node",t.joints[r]));return Promise.all(s)})).then((function(s){return e.traverse((function(e){if(e.isMesh){for(var r=[],n=[],i=0,a=s.length;i<a;i++){var o=s[i];if(o){r.push(o);var l=new H;void 0!==t.inverseBindMatrices&&l.fromArray(t.inverseBindMatrices.array,16*i),n.push(l)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',t.joints[i])}e.bind(new k(r,n),e.matrixWorld)}})),e}));var t})).then((function(t){s.add(t);var a=[];if(i.children)for(var o=i.children,l=0,u=o.length;l<u;l++){var c=o[l];a.push(e(c,t,r,n))}return Promise.all(a)}))}return function(t){var s=this.json,r=this.extensions,n=this.json.scenes[t],i=new P;n.name&&(i.name=this.createUniqueName(n.name)),$e(i,n),n.extensions&&ze(r,i,n);for(var a=n.nodes||[],o=[],l=0,u=a.length;l<u;l++)o.push(e(a[l],i,s,this));return Promise.all(o).then((function(){return i}))}}(),le}();export{at as G,it as L,Ke as h};
