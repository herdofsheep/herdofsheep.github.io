import{L as e,h as t}from"./lit-element-61c1989f.js";import{V as i,a as s,P as n,S as o,C as r,W as h,A as a,b as l,c as d,G as c,M as p,Q as g,d as m,e as u,E as f,f as w,F as y}from"./three.module-98a4b09c.js";import"./lodash-a1d2dbc5.js";import{G as b}from"./GLTFLoader.js";import{T as v}from"./TrackballControls.js";import{B as k}from"./BufferGeometryUtils.js";window.customElements.define("ray-cast",class extends e{static get properties(){return{container:{type:Object},camera:{type:Object},controls:{type:Object},scene:{type:Object},renderer:{type:Object},pickingTexture:{type:Object},pickingScene:{type:Object},highlightShape:{type:Object},mouse:{type:Object},mousePosX:{type:Object},mousePosY:{type:Object},infoVisible:{type:String},offset:{type:Object},pickingData:{type:Object},cursorType:{type:String},canClick:{type:Boolean},link:{type:String},duplicated:{type:Boolean},que:{type:Object},work:{type:Object},queBig:{type:Object},workBig:{type:Object},files:{type:Array}}}constructor(){super(),this.mouse=new i,this.mousePosX="0px",this.mousePosY="0px",this.beganTouching=!1,this.offset=new s(1,1,1),this.duplicated=!1,this.pickingData=[],this.cursorType="grab",this.canClick=!1,this.link="",this.addEventListener("click",this.clickLink),this.addEventListener("touchstart",this.touchStart),this.addEventListener("touchmove",this.touchMove),this.addEventListener("touchcancel",this.touchMove),this.addEventListener("touchend",this.touchEnd)}render(){return t`<style>:host{cursor:${this.cursorType}}.followMouse{top:${this.mousePosY};left:${this.mousePosX};color:#fff;font-size:50px;visibility:${this.infoVisible};position:absolute;z-index:10}#crosshair{top:${this.YCenter};left:${this.XCenter};position:absolute;visibility:hidden;width:0;height:0;z-index:100}#upSpoke{background:#fff;height:10px;width:2px;transform:translateY(-3px)}#sideSpoke{background:#fff;height:2px;width:10px;transform:translate(-4px,-9px)}#container{top:0;position:absolute}@media (hover:none){#crosshair{visibility:visible}}</style><div id="container"></div><div id="infoText" class="followMouse"></div><div id="crosshair"><div id="upSpoke"></div><div id="sideSpoke"></div></div>`}async firstUpdated(){await new Promise((e=>setTimeout(e,0))),this.init(),this.animate()}init(){this.container=this.shadowRoot.getElementById("container"),this.camera=new n(70,window.innerWidth/window.innerHeight,1,1e4),this.camera.position.z=1e3,this.XCenter=window.innerWidth/2+"px",this.YCenter=window.innerHeight/2+"px",this.mousePosX=this.XCenter,this.mousePosY=this.YCenter,this.scene=new o,this.scene.background=new r(4342338),this.pickingScene=new o,this.pickingTexture=new h(1,1),this.scene.add(new a(5592405));const e=new l(16777215,1.5);e.position.set(0,500,2e4),this.scene.add(e),this.files=["que","work","github","math"],this.work=this.loadModel("/src/assets/models/gltf/radcam.glb"),this.workBig=this.loadModel("/src/assets/models/gltf/radcamBig.glb"),this.que=this.loadModel("/src/assets/models/gltf/questionmark.glb"),this.queBig=this.loadModel("/src/assets/models/gltf/questionmarkBig.glb"),this.github=this.loadModel("/src/assets/models/gltf/github.glb"),this.githubBig=this.loadModel("/src/assets/models/gltf/githubBig.glb"),this.math=this.loadModel("/src/assets/models/gltf/math.glb"),this.mathBig=this.loadModel("/src/assets/models/gltf/mathBig.glb"),this.renderer=new d({antialias:!0}),this.renderer.setPixelRatio(window.devicePixelRatio),this.renderer.setSize(window.innerWidth,window.innerHeight),this.container.appendChild(this.renderer.domElement),this.controls=new v(this.camera,this.renderer.domElement),this.controls.rotateSpeed=-1,this.controls.zoomSpeed=1.2,this.controls.panSpeed=-.8,this.controls.noZoom=!1,this.controls.noPan=!1,this.controls.staticMoving=!0,this.controls.dynamicDampingFactor=.3,this.renderer.domElement.addEventListener("mousemove",this.onMouseMove.bind(this)),window.addEventListener("resize",this.onWindowResize.bind(this),!1)}onWindowResize(){this.camera.aspect=window.innerWidth/window.innerHeight,this.camera.updateProjectionMatrix(),this.renderer.setSize(window.innerWidth,window.innerHeight),this.XCenter=window.innerWidth/2+"px",this.YCenter=window.innerHeight/2+"px",this.mousePosX=this.XCenter,this.mousePosY=this.YCenter}onMouseMove(e){this.mouse.x=e.clientX,this.mouse.y=e.clientY,this.mousePosX=this.mouse.x+15+"px",this.mousePosY=this.mouse.y+15+"px"}loadModel(e){var t=new b,i=new c;return t.load(e,(function(e){e.scene.traverse((function(e){})),i.add(e.scene)})),i}animate(){window.requestAnimationFrame((()=>this.animate())),0==this.duplicated&&this.duplicate(),1==this.duplicated&&this.threeRender()}threeRender(){this.controls.update(),this.pick(),this.renderer.setRenderTarget(null),this.renderer.render(this.scene,this.camera)}duplicate(){var e=this.files;const t={},i={},n=new p,o=new g,h=new r,a=new m({vertexColors:!0}),l=new u({color:16777215,flatShading:!0,vertexColors:!0,shininess:0});var d=this.cloneFiles(e);if(null!=d){for(var c in this.parentElement.children.loading.style.visibility="hidden",e){var y=e[c];t[y]=[],i[y]=[]}for(let r=1;r<51;r++){var b=d[Math.floor(Math.random()*e.length)],v=b.data.clone();const a=new s;a.x=1e4*Math.random()-5e3,a.y=6e3*Math.random()-3e3,a.z=8e3*Math.random()-4e3;const l=new f;l.x=2*Math.random()*Math.PI,l.y=2*Math.random()*Math.PI,l.z=2*Math.random()*Math.PI;const c=new s(50,50,50);o.setFromEuler(l),n.compose(a,o,c),v.applyMatrix4(n),this.applyVertexColors(v,h.setHex(394758)),t[b.type].push(v),v=v.clone(),this.applyVertexColors(v,h.setHex(r)),i[b.type].push(v),this.pickingData[r]={position:a,rotation:l,scale:c,type:b.type}}for(var c in this.highlightShape={},e){var x=e[c];if("work"==x)var M=13199411;if("github"==x)M=3608130;if("que"==x)M=16728418;if("math"==x)M=12575679;this.highlightShape[e[c]]=new w(d[c].bigData,new u({color:M,flatShading:!1,shininess:150})),this.scene.add(this.highlightShape[e[c]]),this.objects=new w(k.mergeBufferGeometries(t[e[c]]),l),this.scene.add(this.objects),this.pickingScene.add(new w(k.mergeBufferGeometries(i[e[c]]),a))}this.duplicated=!0}}cloneFiles(e){for(var t in e){var i=_.get(this,[e[t],"children",0,"children"],null),s=_.get(this,[e[t]+"Big","children",0,"children"],null);if(null==i||null==s)return null}var n=[];for(var t in e){var o={},r=e[t],h=_.get(this,[r,"children",0,"children"]);if(h.find((e=>"Mesh"==e.type)))o.data=h.find((e=>"Mesh"==e.type)).geometry;else{var a=h.find((e=>"Group"==e.type));if(a){for(var l=[],d=0;d<a.children.length;d++){var c=a.children[d].geometry;l.push(c)}var p=k.mergeBufferGeometries(l);o.data=p}}var g=_.get(this,[r+"Big","children",0,"children"]);if(g.find((e=>"Mesh"==e.type)))o.bigData=g.find((e=>"Mesh"==e.type)).geometry;else{var m=g.find((e=>"Group"==e.type));if(m){for(l=[],d=0;d<m.children.length;d++){c=m.children[d].geometry;l.push(c)}p=k.mergeBufferGeometries(l);o.bigData=p}}o.type=r,n.push(o)}return n}pick(){var e=this.mouse.x,t=this.mouse.y;window.matchMedia("(hover: none)").matches&&(e=this.XCenter.replace("px",""),t=this.YCenter.replace("px","")),this.camera.setViewOffset(this.renderer.domElement.width,this.renderer.domElement.height,e*window.devicePixelRatio|0,t*window.devicePixelRatio|0,1,1),this.renderer.setRenderTarget(this.pickingTexture),this.renderer.render(this.pickingScene,this.camera),this.camera.clearViewOffset();const i=new Uint8Array(4);this.renderer.readRenderTargetPixels(this.pickingTexture,0,0,1,1,i);const s=i[0]<<16|i[1]<<8|i[2],n=this.pickingData[s];var o=this.shadowRoot.getElementById("infoText");if(s>0?(this.cursorType="pointer",this.infoVisible="visible","work"==n.type&&(this.link="src/portfolio.html",o.innerHTML="work portfolio"),"github"==n.type&&(this.link="https://github.com/herdofsheep",o.innerHTML="github"),"que"==n.type&&(this.link="src/what.html",o.innerHTML="what's this?"),"math"==n.type&&(this.link="src/art.html",o.innerHTML="art portfolio"),this.canClick=!0):this.infoVisible="hidden",n&&s>0)n.position&&n.rotation&&n.scale&&n.type&&(this.highlightShape[n.type].position.copy(n.position),this.highlightShape[n.type].rotation.copy(n.rotation),this.highlightShape[n.type].scale.copy(n.scale).add(this.offset),this.highlightShape[n.type].visible=!0);else{for(var r in this.files)this.highlightShape[this.files[r]].visible=!1;this.cursorType="cell",this.canClick=!1}}clickLink(){this.canClick&&(window.location.href=this.link)}touchStart(){this.canClick&&(this.beganTouching=!0)}touchMove(){this.beganTouching=!1}touchEnd(){this.canClick&&this.beganTouching&&(window.location.href=this.link)}applyVertexColors(e,t){const i=e.attributes.position,s=[];for(let e=0;e<i.count;e++)s.push(t.r,t.g,t.b);e.setAttribute("color",new y(s,3))}});
